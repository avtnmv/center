<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,100..900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="./styles/style.css">
</head>
<body>
    <header class="header">
        <div class="header__logo">
            <a href="https://t.me/+4aRxW1GKn1czOTYy" class="header__logo-link">
                <img src="./assets/images/logo.webp" alt="logo" class="header__logo-img">
            </a>
        </div>
    
        <h1 class="header__title">Выгодный обмен валют в Турции</h1>
    
        <div class="header__description">
            <p> <span class="header__description-bold">Обменивайте USDT</span> и рубли на доллары, лиры или евро и наоборот.</p>
            <p>Получайте кэш <span class="header__description-bold">в наших офисах за 3 минуты.</span></p>
        </div>

        <div class="header__exchange">
            <div class="header__exchange-block">
                <label for="city" class="header__exchange-label">Выберите город:</label>
                <select id="city" class="header__exchange-select">
                    <option value="Стамбул">Стамбул</option>
                    <option value="Аланья">Аланья</option>
                    <option value="Анталья">Анталья</option>
                    <option value="Мерсин">Мерсин</option>
                </select>

                <svg class="header__exchange-arrow" viewBox="0 -4.5 20 20" xmlns="http://www.w3.org/2000/svg"><g stroke-width="0"/><g stroke-linecap="round" stroke-linejoin="round"/><path d="M20 1.39 18.594 0 9.987 8.261l-.918-.881.005.005L1.427.045 0 1.414 9.987 11z" fill-rule="evenodd"/></svg>
            </div>
        
            <div class="header__exchange-block">
                <label for="currency" class="header__exchange-label">Выберите валюту:</label>
                <div class="custom-select" onclick="toggleCustomSelect()">
                    <svg class="header__custom-select-arrow" viewBox="0 -4.5 20 20" xmlns="http://www.w3.org/2000/svg"><g stroke-width="0"/><g stroke-linecap="round" stroke-linejoin="round"/><path d="M20 1.39 18.594 0 9.987 8.261l-.918-.881.005.005L1.427.045 0 1.414 9.987 11z" fill-rule="evenodd"/></svg>
                    <div class="custom-select__selected" onclick="toggleCustomSelect()">
                        <img src="./assets/images/usdt-icon.svg" class="custom-select__icon" data-value="usdt" onclick="selectOption('usdt')">
                        <span class="custom-select__text">Tether USDT</span>
                    </div>
                    <div class="custom-select__options" id="custom-select-options">
                        <div class="custom-select__option" data-value="usdt" onclick="selectOption('usdt')">
                            <img src="./assets/images/usdt-icon.svg" class="custom-select__icon">
                            <span class="custom-select__text">Tether USDT</span>
                        </div>
                        <div class="custom-select__option" data-value="rub" onclick="selectOption('rub')">
                            <img src="./assets/images/rub-icon.svg" class="custom-select__icon">
                            <span class="custom-select__text">RUB с карты</span>
                        </div>
                        <div class="custom-select__option" data-value="uah" onclick="selectOption('uah')">
                            <img src="./assets/images/uah-icon.svg" class="custom-select__icon">
                            <span class="custom-select__text">UAH с карты</span>
                        </div>
                        <div class="custom-select__option" data-value="usd" onclick="selectOption('usd')">
                            <img src="./assets/images/usd-icon.svg" class="custom-select__icon">
                            <span class="custom-select__text">USD наличные</span>
                        </div>
                        <div class="custom-select__option" data-value="eur" onclick="selectOption('eur')">
                            <img src="./assets/images/eur-icon.svg" class="custom-select__icon">
                            <span class="custom-select__text">EUR наличные</span>
                        </div>

                    </div>
                </div>
            </div>
        
            <div class="header__exchange-block">
                <label for="amount" class="header__exchange-label">Отдаете:</label>
                <input type="text" id="amount" class="header__exchange-input" placeholder="Введите сумму" oninput="updateReceivedAmount()">
            </div>
        
            <div class="header__exchange-block">
                <label for="receive" class="header__exchange-label">Получаете:</label>
                <div class="header__exchange-line">
                    <p id="received-amount" class="header__exchange-received-amount"></p>
                    <select id="receive" class="header__exchange-select--yellow"></select>
                    <svg class="header__exchange-arrow" viewBox="0 -4.5 20 20" xmlns="http://www.w3.org/2000/svg">
                        <g stroke-width="0" />
                        <g stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M20 1.39 18.594 0 9.987 8.261l-.918-.881.005.005L1.427.045 0 1.414 9.987 11z" fill-rule="evenodd" />
                    </svg>
                </div>
            </div>

        </div>

        <a href="https://t.me/+4aRxW1GKn1czOTYy" class="header__link">
            <svg width="25" height="25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22.36 2.855C19.227 4.152 5.793 9.717 2.081 11.233c-2.49.972-1.032 1.883-1.032 1.883s2.125.728 3.946 1.275c1.822.546 2.793-.061 2.793-.061l8.561-5.768c3.036-2.064 2.308-.364 1.579.364-1.579 1.579-4.19 4.068-6.375 6.072-.972.85-.486 1.579-.061 1.943 1.579 1.335 5.89 4.068 6.133 4.25 1.282.908 3.805 2.215 4.189-.546l1.518-9.533c.486-3.218.971-6.193 1.032-7.043.182-2.064-2.004-1.214-2.004-1.214Z" fill="#fff"/></svg>

            Обменять сейчас
        </a>

    </header>


    <main>
        <section></section>
    </main>

    <footer></footer>

    <script>
        // Функция для обновления опций валюты для получения
function updateReceiveOptions(selectedCurrency) {
    const receiveSelect = document.getElementById("receive");

    const receiveOptions = {
        usdt: ["usd", "try"],
        rub: ["try", "usd"],
        uah: ["try"],
        usd: ["usdt", "try"],
        eur: ["usdt"]
    };

    const currencyNames = {
        usdt: "Tether USDT",
        rub: "RUB с карты",
        uah: "UAH с карты",
        usd: "USD наличные",
        eur: "EUR наличные",
        try: "TRY наличные"
    };

    const currencyFlags = {
        usdt: "./assets/images/usdt-icon.svg",
        rub: "./assets/images/rub-icon.svg",
        uah: "./assets/images/uah-icon.svg",
        usd: "./assets/images/usd-icon.svg",
        eur: "./assets/images/eur-icon.svg",
        try: "./assets/images/try-icon.svg"
    };

    receiveSelect.innerHTML = ""; // Очищаем текущие опции

    if (receiveOptions[selectedCurrency]) {
        receiveOptions[selectedCurrency].forEach(val => {
            let option = document.createElement("option");
            option.value = val;
            option.textContent = currencyNames[val]; // Текст будет в выпадающем списке
            option.dataset.flag = currencyFlags[val]; // Добавляем путь к флагу
            receiveSelect.appendChild(option);
        });
    }

    // Устанавливаем выбранную валюту
    if (receiveSelect.options.length > 0) {
        receiveSelect.value = receiveSelect.options[0].value; // Проставляем первую валюту
        updateFlag(receiveSelect); // Обновляем флаг
    }

    updateReceivedAmount(); // Обновляем сумму
}

// Функция для обновления флага в select
function updateFlag(select) {
    const selectedOption = select.options[select.selectedIndex];
    const flagPath = selectedOption.dataset.flag;
    select.style.backgroundImage = `url(${flagPath})`;
    select.style.backgroundRepeat = "no-repeat";
    select.style.backgroundPosition = "left center";
    select.style.backgroundSize = "20px";
}

// Функция для обновления суммы получения
async function updateReceivedAmount() {
    const amount = parseFloat(document.getElementById("amount").value);
    const selected = document.querySelector(".custom-select__selected");
    const currency = selected ? selected.dataset.value : null; // Берем валюту из кастомного селекта
    const receiveSelect = document.getElementById("receive");

    if (!amount || amount <= 0 || !currency || receiveSelect.options.length === 0) {
        document.getElementById("received-amount").textContent = "";
        return;
    }

    const receiveCurrency = receiveSelect.value;

    try {
        const exchangeRates = await fetchExchangeRates(currency, receiveCurrency);
        if (exchangeRates && exchangeRates.rate) {
            const receivedAmount = (amount * exchangeRates.rate).toFixed(2);
            document.getElementById("received-amount").textContent = `${receivedAmount}`;
        } else {
            document.getElementById("received-amount").textContent = "Ошибка получения курса";
        }
    } catch (error) {
        console.error("Ошибка при получении курса:", error);
        document.getElementById("received-amount").textContent = "Ошибка получения курса";
    }
}

// Функция для получения курсов валют через API (заглушка)
async function fetchExchangeRates(fromCurrency, toCurrency) {
    // Для теста возвращаем заглушку
    return { rate: 1.0 };
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function () {
    // Устанавливаем начальное значение для кастомного селекта
    const selected = document.querySelector(".custom-select__selected");
    if (selected && !selected.dataset.value) {
        selected.dataset.value = "usdt";
    }

    // Инициализируем опции получения валюты
    updateReceiveOptions('usdt');

    // Принудительно обновляем курс при загрузке
    updateReceivedAmount();
});

// Слушаем изменение в "Получаете"
const receiveSelect = document.getElementById("receive");
receiveSelect.addEventListener("change", function () {
    updateFlag(receiveSelect); // Обновляем флаг
    updateReceivedAmount(); // Обновляем сумму
});

// Функция для обработки клика по кастомному селекту
function selectOption(value) {
    const selected = document.querySelector(".custom-select__selected");
    const options = document.querySelectorAll(".custom-select__option");
    const selectedOption = Array.from(options).find(option => option.dataset.value === value);

    if (selectedOption) {
        selected.innerHTML = selectedOption.innerHTML;
        selected.dataset.value = value;  // Добавляем data-value
        updateReceiveOptions(value);  // Передаем выбранную валюту
    }

    toggleCustomSelect();
}

// Открытие/закрытие кастомного селекта
function toggleCustomSelect() {
    const options = document.getElementById("custom-select-options");
    options.classList.toggle("show");
}

// Закрытие кастомного селекта при клике вне его
window.onclick = function(event) {
    const customSelect = document.querySelector(".custom-select");
    const options = document.getElementById("custom-select-options");

    // Если клик был не по самому селекту или не по его опциям, закрываем
    if (!customSelect.contains(event.target) && options.classList.contains('show')) {
        options.classList.remove('show');
    }
}

// Слушаем клики по всему контейнеру .custom-select
document.querySelectorAll('.custom-select').forEach(select => {
    select.addEventListener("click", function() {
        toggleCustomSelect();
    });
});

function toggleCustomSelect() {
    const options = document.getElementById("custom-select-options");
    const link = document.querySelector(".header__link");

    // Проверяем, что элементы существуют
    if (!options || !link) {
        console.error("Элементы не найдены: options или link");
        return;
    }

    // Переключаем класс "show"
    options.classList.toggle("show");

    // Получаем ширину окна (разрешение экрана)
    const windowWidth = window.innerWidth;

    // Изменяем отступ ссылки в зависимости от состояния и ширины окна
    if (options.classList.contains("show")) {
        if (windowWidth > 900) {
            link.style.marginTop = "180px";  // Добавляем отступ для разрешения <= 900px
        } else {
            link.style.marginTop = "64px";  // Возвращаем исходный отступ для разрешения > 900px
        }
    } else {
        link.style.marginTop = "64px";  // Возвращаем исходный отступ, если меню закрыто
    }
}
    </script>
</body>
</html>